USE master
go
drop database QLBHLT
go
CREATE DATABASE QLBHLT
GO
USE QLBHLT
GO
CREATE TABLE TaiKhoan
(
	TenTaiKhoan NVARCHAR(30) NOT NULL,
	MatKhau NVARCHAR(30) NOT NULL,
	MANHANVIEN NVARCHAR(20) NOT NULL,
	MACHUCVU NVARCHAR(20) NOT NULL,
	CONSTRAINT PK_TaiKhoan PRIMARY KEY (TenTaiKhoan)
)
GO
Select * from TaiKhoan
Insert into TaiKhoan([TenTaiKhoan],[MatKhau],[MANHANVIEN],[MACHUCVU])Values('admin1', 'admin1', 'NV001','CV001')
Insert into TaiKhoan([TenTaiKhoan],[MatKhau],[MANHANVIEN],[MACHUCVU])Values('admin2', 'admin2', 'NV002','CV001')
Insert into TaiKhoan([TenTaiKhoan],[MatKhau],[MANHANVIEN],[MACHUCVU])Values('admin3', 'admin3', 'NV003','CV001')
Insert into TaiKhoan([TenTaiKhoan],[MatKhau],[MANHANVIEN],[MACHUCVU])Values('admin4', 'admin4', 'NV004','CV001')
Insert into TaiKhoan([TenTaiKhoan],[MatKhau],[MANHANVIEN],[MACHUCVU])Values('admin5', 'admin5', 'NV005','CV001')
Insert into TaiKhoan([TenTaiKhoan],[MatKhau],[MANHANVIEN],[MACHUCVU])Values('admin6', 'admin6', 'NV006','CV002')
Insert into TaiKhoan([TenTaiKhoan],[MatKhau],[MANHANVIEN],[MACHUCVU])Values('admin7', 'admin7', 'NV007','CV002')

Select HOTENNV from TaiKhoan, NHANVIEN where TaiKhoan.MANHANVIEN = NHANVIEN.MANHANVIEN and TenTaiKhoan = 'admin1'

Select TenTaiKhoan, MatKhau, HOTENNV, TENCHUCVU from TaiKhoan, NHANVIEN, CHUCVU where TaiKhoan.MANHANVIEN = NHANVIEN.MANHANVIEN and TaiKhoan.MACHUCVU = CHUCVU.MACHUCVU and TenTaiKhoan = 'admin1'


CREATE TABLE NHANVIEN
(
	MANHANVIEN NVARCHAR(20) NOT NULL,
	HOTENNV NVARCHAR(50) NOT NULL,
	GIOITINH BIT,
	NGAYSINH SMALLDATETIME,
	DIACHINV NVARCHAR(100),
	SDTNV INT,
	MACHUCVU NVARCHAR(20) NOT NULL,
	CONSTRAINT PK_NHANVIEN PRIMARY KEY (MANHANVIEN)
);
GO
CREATE TABLE CHUCVU
(
	MACHUCVU NVARCHAR(20) NOT NULL,
	TENCHUCVU NVARCHAR(30) NOT NULL,
	CONSTRAINT PK_CHUCVU PRIMARY KEY (MACHUCVU)
);
GO

ALTER TABLE dbo.NHANVIEN ADD CONSTRAINT FK_NHANVIEN_CHUCVU FOREIGN KEY (MACHUCVU) REFERENCES dbo.CHUCVU (MACHUCVU)
GO

INSERT INTO CHUCVU(MACHUCVU, TENCHUCVU)VALUES('CV001',N'Nhân Viên')
INSERT INTO CHUCVU(MACHUCVU, TENCHUCVU)VALUES('CV002',N'Quản Lý')
go

INSERT INTO NHANVIEN(MANHANVIEN, HOTENNV, DIACHINV, NGAYSINH, GIOITINH, SDTNV, MACHUCVU)VALUES('NV001',N'Lê Quốc Huy',N'125 Bến Tre','7/13/2001','1','0389813833','CV001')
INSERT INTO NHANVIEN(MANHANVIEN, HOTENNV, DIACHINV, NGAYSINH, GIOITINH, SDTNV, MACHUCVU)VALUES('NV002',N'Trịnh Nhựt Nam',N'168 Hồ Chí Minh','1/8/2001','1','0577445200','CV001')
INSERT INTO NHANVIEN(MANHANVIEN, HOTENNV, DIACHINV, NGAYSINH, GIOITINH, SDTNV, MACHUCVU)VALUES('NV003',N'Lê Thị Hạnh Thảo',N'255 Hải Dương','3/23/2001','0','0221193084','CV001')
INSERT INTO NHANVIEN(MANHANVIEN, HOTENNV, DIACHINV, NGAYSINH, GIOITINH, SDTNV, MACHUCVU)VALUES('NV004',N'Nguyễn Hoàng Dương',N'364 Cần Thơ','8/15/2001','1','0876960241','CV001')
INSERT INTO NHANVIEN(MANHANVIEN, HOTENNV, DIACHINV, NGAYSINH, GIOITINH, SDTNV, MACHUCVU)VALUES('NV005',N'Nguyễn Phạm Thu Ngân',N'148 Đà Nẵng','8/25/2001','0','0520384777','CV001')
INSERT INTO NHANVIEN(MANHANVIEN, HOTENNV, DIACHINV, NGAYSINH, GIOITINH, SDTNV, MACHUCVU)VALUES('NV006',N'Nguyễn Huỳnh Khánh Đoan',N'545 Hải Phòng','10/11/2001','0','0586111895','CV002')
INSERT INTO NHANVIEN(MANHANVIEN, HOTENNV, DIACHINV, NGAYSINH, GIOITINH, SDTNV, MACHUCVU)VALUES('NV007',N'Lê Văn Duy',N'931 Hà Nội','3/9/2001','1','0541225589','CV002')
go


CREATE TABLE DANHMUC
(
	MADANHMUC NVARCHAR(20) NOT NULL,
	TENDANHMUC NVARCHAR(50) NOT NULL,
	CONSTRAINT PK_DANHMUC PRIMARY KEY (MADANHMUC)
);
GO


CREATE TABLE SANPHAM
(
	MASP NVARCHAR(20) NOT NULL,
	TENSANPHAM NVARCHAR(50) NOT NULL,
	GIA NVARCHAR(50) NOT NULL,
	SOLUONG INT,
	HANGSX NVARCHAR(20) NOT NULL,
	MADANHMUC NVARCHAR(20) NOT NULL,
	CONSTRAINT PK_SANPHAM PRIMARY KEY (MASP)
);
GO


ALTER TABLE [dbo].[SANPHAM] ADD CONSTRAINT FK_SANPHAM_DANHMUC FOREIGN KEY ([MADANHMUC]) REFERENCES  DANHMUC ([MADANHMUC])
GO

INSERT DANHMUC([MADANHMUC], [TENDANHMUC]) VALUES ('DM001', N'LAPTOP')
GO

INSERT INTO SANPHAM([MASP], [TENSANPHAM], [GIA], [SOLUONG], [HANGSX], [MADANHMUC] ) VALUES ('SP001', 'ASUS ROG STRIX G17 G713QM', '40990000', '100', 'ASUS','DM001')
INSERT INTO SANPHAM([MASP], [TENSANPHAM], [GIA], [SOLUONG], [HANGSX], [MADANHMUC] ) VALUES ('SP002', 'ASUS ROG STRIX G17 G713QR', '47990000', '200', 'ASUS','DM001')
INSERT INTO SANPHAM([MASP], [TENSANPHAM], [GIA], [SOLUONG], [HANGSX], [MADANHMUC] ) VALUES ('SP003', 'ASUS ROG TUF DASH F15 FX516PE', '27990000', '120', 'ASUS','DM001')
INSERT INTO SANPHAM([MASP], [TENSANPHAM], [GIA], [SOLUONG], [HANGSX], [MADANHMUC] ) VALUES ('SP004', 'ASUS ROG TUF F15 FX506HM', '28490000', '54', 'ASUS','DM001')
INSERT INTO SANPHAM([MASP], [TENSANPHAM], [GIA], [SOLUONG], [HANGSX], [MADANHMUC] ) VALUES ('SP005', 'ASUS ROG TUF A15 FA506QR', '36990000', '20', 'ASUS','DM001')
INSERT INTO SANPHAM([MASP], [TENSANPHAM], [GIA], [SOLUONG], [HANGSX], [MADANHMUC] ) VALUES ('SP006', 'ASUS ROG ZEPHYRUS DUO 15 SE GX551QR', '109990000', '30', 'ASUS','DM001')
INSERT INTO SANPHAM([MASP], [TENSANPHAM], [GIA], [SOLUONG], [HANGSX], [MADANHMUC] ) VALUES ('SP007', 'ASUS ROG ZEPHYRUS S17 GX703HS', '94990000', '60', 'ASUS','DM001')
INSERT INTO SANPHAM([MASP], [TENSANPHAM], [GIA], [SOLUONG], [HANGSX], [MADANHMUC] ) VALUES ('SP008', 'ASUS ROG ZEPHYRUS M16 GU603HR', '71990000', '10', 'ASUS','DM001')
INSERT INTO SANPHAM([MASP], [TENSANPHAM], [GIA], [SOLUONG], [HANGSX], [MADANHMUC] ) VALUES ('SP009', 'ASUS ROG FLOW X13 GV301QC', '79990000', '18', 'ASUS','DM001')
INSERT INTO SANPHAM([MASP], [TENSANPHAM], [GIA], [SOLUONG], [HANGSX], [MADANHMUC] ) VALUES ('SP010', 'ASUS ROG', '23000000', '140', 'ASUS','DM001')
go

Select masp, tensanpham, gia, soluong, hangsx,tendanhmuc from SANPHAM sp, DANHMUC dm where sp.MADANHMUC = dm.MADANHMUC  and MASP = 'SP001'

CREATE TABLE KHACHHANG
(
	MAKH NVARCHAR(20) NOT NULL,
	TENKH NVARCHAR(50) NOT NULL,
	DIACHIKH NVARCHAR(100) NOT NULL,
	GIOITINHKH BIT,
	SDTKH INT,
	NGAYSINHKH SMALLDATETIME NOT NULL,
	MANHANVIEN NVARCHAR(20) NOT NULL,
	CONSTRAINT PK_KHACHHANG PRIMARY KEY (MAKH)
);
GO

ALTER TABLE KHACHHANG ADD CONSTRAINT FK_KHACHHANG_NHANVIEN FOREIGN KEY (MANHANVIEN) REFERENCES  NHANVIEN (MANHANVIEN)
GO

INSERT INTO KHACHHANG([MAKH], [TENKH], [DIACHIKH], [GIOITINHKH], [SDTKH], NGAYSINHKH, [MANHANVIEN]) VALUES ('KH001', N'Đỗ An Trường', N'254 Long An', '1', '0462254661','3/12/2001', 'NV001')
INSERT INTO KHACHHANG([MAKH], [TENKH], [DIACHIKH], [GIOITINHKH], [SDTKH], NGAYSINHKH, [MANHANVIEN]) VALUES ('KH002', N'Đào Phước Sơn', N'458 Hà Giang', '1', '0738295939','6/12/2001', 'NV003')
INSERT INTO KHACHHANG([MAKH], [TENKH], [DIACHIKH], [GIOITINHKH], [SDTKH], NGAYSINHKH, [MANHANVIEN]) VALUES ('KH003', N'Liêu Trung Thành', N'80 An Giang', '1', '0216678039','2/22/2001', 'NV005')
INSERT INTO KHACHHANG([MAKH], [TENKH], [DIACHIKH], [GIOITINHKH], [SDTKH], NGAYSINHKH, [MANHANVIEN]) VALUES ('KH004', N'Lê Xuân Vũ', N'150 Vũng Tàu', '1', '0268361623','5/10/2001', 'NV004')
INSERT INTO KHACHHANG([MAKH], [TENKH], [DIACHIKH], [GIOITINHKH], [SDTKH], NGAYSINHKH, [MANHANVIEN]) VALUES ('KH005', N'Thân Nhật Khương', N'112 Bến Tre', '1', '0250439659','6/15/2001', 'NV001')
INSERT INTO KHACHHANG([MAKH], [TENKH], [DIACHIKH], [GIOITINHKH], [SDTKH], NGAYSINHKH, [MANHANVIEN]) VALUES ('KH006', N'Điêu Tuyết Trinh', N'145 Vĩnh Long', '0', '0986486860','11/12/2001', 'NV002')
INSERT INTO KHACHHANG([MAKH], [TENKH], [DIACHIKH], [GIOITINHKH], [SDTKH], NGAYSINHKH, [MANHANVIEN]) VALUES ('KH007', N'Lý Sơn Tuyền', N'202 Trà Vinh', '0', '0272495073','12/22/2001', 'NV002')
INSERT INTO KHACHHANG([MAKH], [TENKH], [DIACHIKH], [GIOITINHKH], [SDTKH], NGAYSINHKH, [MANHANVIEN]) VALUES ('KH008', N'La Tố Nga', N'625 Hải Phòng', '0', '0676728674','7/12/2001', 'NV003')
INSERT INTO KHACHHANG([MAKH], [TENKH], [DIACHIKH], [GIOITINHKH], [SDTKH], NGAYSINHKH, [MANHANVIEN]) VALUES ('KH009', N'Mạc Huyền Nhi', N'10 Hà Nội', '0', '0160070481','2/9/2001', 'NV005')
INSERT INTO KHACHHANG([MAKH], [TENKH], [DIACHIKH], [GIOITINHKH], [SDTKH], NGAYSINHKH, [MANHANVIEN]) VALUES ('KH010', N'Hà Thành An', N'254 Cà Mau', '1', '0261204488','11/6/2001', 'NV004')
go

CREATE TABLE HOADON
(
	MaHD NVARCHAR(20) NOT NULL,
	NgayLapHD Nvarchar (30) not null,
	MaNhanVien nvarchar (20) not null,
	MAKH nvarchar (20) not null,
	constraint PK_HoaDon primary key (MaHD) 	
)
GO
create table CTHD
(
MaHD nvarchar(20)not null  ,
MaSP nvarchar (20) not null,
SoLuong int not null,
Gia nvarchar(50) not null,
constraint PK_CTHD primary key (MaHD,MaSP ) 
)
go
ALTER TABLE dbo.CTHD ADD CONSTRAINT FK_CTHD_HOADON FOREIGN KEY (MaHD) REFERENCES dbo.HOADON (MaHD)
go
ALTER TABLE dbo.CTHD ADD CONSTRAINT FK_CTHD_SANPHAM FOREIGN KEY (MaSP) REFERENCES dbo.SANPHAM (MaSP)
go
ALTER TABLE dbo.HOADON ADD CONSTRAINT FK_HOADON_KHACHHANG FOREIGN KEY (MAKH) REFERENCES dbo.KHACHHANG (MAKH)
go
ALTER TABLE dbo.HOADON ADD CONSTRAINT FK_HOADON_NHANVIEN FOREIGN KEY (MANHANVIEN) REFERENCES dbo.NHANVIEN (MaNhanVien)
go
ALTER TABLE dbo.TaiKhoan ADD CONSTRAINT FK_TAIKHOAN_NHANVIEN FOREIGN KEY (MANHANVIEN) REFERENCES dbo.NHANVIEN (MANHANVIEN)
go
ALTER TABLE dbo.TaiKhoan ADD CONSTRAINT FK_TaiKhoan_CHUCVU FOREIGN KEY (MACHUCVU) REFERENCES dbo.CHUCVU (MACHUCVU)
go
---Thêm hoá đơn
INSERT INTO HOADON([MaHD], [NgayLapHD], [MaNhanVien], [MAKH])VALUES('HD001','9/7/2021','NV001','KH001')
INSERT INTO HOADON([MaHD], [NgayLapHD], [MaNhanVien], [MAKH])VALUES('HD002','9/7/2021','NV001','KH001')
INSERT INTO HOADON([MaHD], [NgayLapHD], [MaNhanVien], [MAKH])VALUES('HD003','9/7/2021','NV001','KH001')
---Thêm chi tiết hoá đơn
INSERT INTO CTHD([MaHD], [MaSP], [SoLuong], [Gia])VALUES('HD001','SP001','1','40990000')
INSERT INTO CTHD([MaHD], [MaSP], [SoLuong], [Gia])VALUES('HD001','SP003','1','27990000')
INSERT INTO CTHD([MaHD], [MaSP], [SoLuong], [Gia])VALUES('HD002','SP002','1','47990000')
INSERT INTO CTHD([MaHD], [MaSP], [SoLuong], [Gia])VALUES('HD002','SP005','1','36990000')
INSERT INTO CTHD([MaHD], [MaSP], [SoLuong], [Gia])VALUES('HD003','SP004','1','28490000')
INSERT INTO CTHD([MaHD], [MaSP], [SoLuong], [Gia])VALUES('HD003','SP010','1','23000000')

Select makh, tenkh, diachikh, sdtkh,gioitinhkh ,ngaysinhkh, hotennv from KHACHHANG kh, NHANVIEN nv where kh.MANHANVIEN = nv.MANHANVIEN and MAKH = 'KH001'

Select manhanvien, HOTENNV, DIACHINV, ngaysinh, gioitinh, SDTNV,  tenchucvu from NhanVien nv, ChucVu cv where nv.MACHUCVU=cv.MACHUCVU

select MAKH, TENKH, DIACHIKH, case when GIOITINHKH = 0 then N'Nữ' when GIOITINHKH = 1 then N'Nam' else N'Không xác định' end GIOITINH, SDTKH, NGAYSINHKH, HOTENNV from KHACHHANG KH, NHANVIEN NV  where KH.MANHANVIEN = NV.MANHANVIEN  and MAKH = 'KH001'

Select makh, tenkh, diachikh, gioitinhkh, sdtkh, NGAYSINHKH, tensanpham,  hotennv from NhanVien nv,  KhachHang kh, Sanpham sp  where nv.manhanvien=kh.manhanvien  and makh= 'KH001' 

SELECT * from SANPHAM

Select cv.MACHUCVU, TENCHUCVU, HOTENNV, case when GIOITINH = 0 then N'Nữ' when GIOITINH = 1 then N'Nam' else N'Không xác định' end GIOITINH, NGAYSINH, DIACHINV, SDTNV FROM NHANVIEN nv, CHUCVU cv where nv.MACHUCVU = cv.MACHUCVU

Select dm.MADANHMUC, dm.TENDANHMUC, TENSANPHAM, GIA, SOLUONG, HANGSX from DANHMUC dm, SANPHAM sp where dm.MADANHMUC = sp.MADANHMUC

SELECT HOADON.MaHD, TENKH, TENSANPHAM, CTHD.SoLuong, SANPHAM.GIA, (CTHD.SoLuong*SANPHAM.GIA) as ThanhTien FROM HOADON, CTHD ,KHACHHANG, SANPHAM WHERE HOADON.MaHD = CTHD.MaHD AND HOADON.MAKH = KHACHHANG.MAKH AND CTHD.MaSP = SANPHAM.MASP AND HOADON.MaHD = 'HD001'


select * from TaiKhoan where TenTaiKhoan= 'admin1' and MatKhau = 'admin1'

select HOTENNV from NHANVIEN where MANHANVIEN = 'NV001'
Update SANPHAM set SOLUONG = SOLUONG-2 WHERE MASP = 'SP001'
SELECT * FROM SANPHAM

